openapi: 3.1.0
info:
  title: Godel API
  description: Multi-agent orchestration platform API for managing agents, swarms, sessions, and workflows
  version: 3.0.0
  contact:
    name: Godel Support
    url: https://github.com/davidkimai/godel
servers:
  - url: http://localhost:7373
    description: Local development server
  - url: http://localhost:7373
    description: Production server

tags:
  - name: Capabilities
    description: API discovery and capabilities
  - name: Health
    description: Server health and status endpoints
  - name: Agents
    description: Agent management and monitoring
  - name: Swarms
    description: Swarm orchestration and coordination
  - name: Tasks
    description: Task management
  - name: Bus
    description: Event bus operations
  - name: Metrics
    description: System metrics
  - name: Logs
    description: Log querying

paths:
  /health:
    get:
      tags:
        - Health
      summary: Check server health
      description: Returns the basic health status of the API server. No authentication required.
      operationId: getHealth
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ok, degraded, error]
                  version:
                    type: string
                  uptime:
                    type: integer
                    description: Server uptime in seconds
                  timestamp:
                    type: string
                    format: date-time

  /api/v1/health/detailed:
    get:
      tags:
        - Health
      summary: Detailed health check
      description: Returns detailed health status including component status.
      operationId: getDetailedHealth
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Detailed health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  components:
                    type: object

  /api/v1/health/ready:
    get:
      tags:
        - Health
      summary: Readiness check
      description: Returns whether the server is ready to accept traffic.
      operationId: getReady
      responses:
        '200':
          description: Server is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  ready:
                    type: boolean

  /api/v1/health/live:
    get:
      tags:
        - Health
      summary: Liveness check
      description: Returns whether the server is alive.
      operationId: getLive
      responses:
        '200':
          description: Server is alive
          content:
            application/json:
              schema:
                type: object
                properties:
                  alive:
                    type: boolean

  /api/v1/capabilities:
    get:
      tags:
        - Capabilities
      summary: Get API capabilities
      description: Discover available API capabilities and endpoints.
      operationId: getCapabilities
      responses:
        '200':
          description: API capabilities
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      version:
                        type: string
                      capabilities:
                        type: array

  /api/v1/openapi.json:
    get:
      tags:
        - Capabilities
      summary: Get OpenAPI specification
      operationId: getOpenApiSpec
      responses:
        '200':
          description: OpenAPI specification

  /api/v1/docs:
    get:
      tags:
        - Capabilities
      summary: Get Swagger UI
      operationId: getSwaggerUi
      responses:
        '200':
          description: Swagger UI HTML

  /api/v1/agents:
    get:
      tags:
        - Agents
      summary: List all agents
      description: Retrieves a paginated list of all agents with optional filtering.
      operationId: listAgents
      parameters:
        - name: status
          in: query
          schema:
            type: string
          description: Filter agents by status
        - name: swarmId
          in: query
          schema:
            type: string
          description: Filter agents by swarm ID
        - name: cursor
          in: query
          schema:
            type: string
          description: Pagination cursor
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 500
          description: Number of items per page
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Agents
      summary: Create a new agent
      description: Spawns a new agent with the specified configuration.
      operationId: createAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - model
                - task
              properties:
                label:
                  type: string
                model:
                  type: string
                  description: AI model identifier (e.g., kimi-k2.5, gpt-4o)
                task:
                  type: string
                  description: Initial task description
                swarmId:
                  type: string
                  description: Swarm to join
                maxRetries:
                  type: integer
                  default: 3
                budgetLimit:
                  type: number
      security:
        - ApiKeyAuth: []
      responses:
        '201':
          description: Agent created successfully
        '400':
          description: Validation error
        '401':
          description: Unauthorized

  /api/v1/agents/{id}:
    get:
      tags:
        - Agents
      summary: Get agent details
      description: Retrieves detailed information about a specific agent.
      operationId: getAgent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Unique agent identifier
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Agent details
        '404':
          description: Agent not found

    delete:
      tags:
        - Agents
      summary: Delete agent
      operationId: deleteAgent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '204':
          description: Agent deleted successfully
        '404':
          description: Agent not found

  /api/v1/agents/{id}/kill:
    post:
      tags:
        - Agents
      summary: Kill agent
      description: Forcefully terminates a running agent.
      operationId: killAgent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Agent killed successfully
        '404':
          description: Agent not found

  /api/v1/agents/{id}/restart:
    post:
      tags:
        - Agents
      summary: Restart agent
      description: Restarts a failed or completed agent.
      operationId: restartAgent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Agent restarted successfully
        '404':
          description: Agent not found

  /api/v1/agents/{id}/logs:
    get:
      tags:
        - Agents
      summary: Get agent logs
      description: Retrieves logs for a specific agent.
      operationId: getAgentLogs
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: lines
          in: query
          schema:
            type: integer
            default: 100
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Agent logs
        '404':
          description: Agent not found

  /api/v1/swarms:
    get:
      tags:
        - Swarms
      summary: List all swarms
      description: Retrieves all active and historical swarms.
      operationId: listSwarms
      parameters:
        - name: status
          in: query
          schema:
            type: string
          description: Filter swarms by status
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of swarms
        '401':
          description: Unauthorized

    post:
      tags:
        - Swarms
      summary: Create a new swarm
      description: Creates and initializes a new swarm of agents.
      operationId: createSwarm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                description:
                  type: string
                config:
                  type: object
                  properties:
                    maxAgents:
                      type: integer
                      default: 100
      security:
        - ApiKeyAuth: []
      responses:
        '201':
          description: Swarm created successfully
        '400':
          description: Validation error

  /api/v1/swarms/{id}:
    get:
      tags:
        - Swarms
      summary: Get swarm details
      description: Retrieves detailed information about a swarm.
      operationId: getSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm details
        '404':
          description: Swarm not found

    put:
      tags:
        - Swarms
      summary: Update swarm
      operationId: updateSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm updated
        '404':
          description: Swarm not found

    delete:
      tags:
        - Swarms
      summary: Delete swarm
      operationId: deleteSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '204':
          description: Swarm deleted
        '404':
          description: Swarm not found

  /api/v1/swarms/{id}/start:
    post:
      tags:
        - Swarms
      summary: Start swarm
      description: Starts a swarm and begins agent execution.
      operationId: startSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm started
        '404':
          description: Swarm not found

  /api/v1/swarms/{id}/stop:
    post:
      tags:
        - Swarms
      summary: Stop swarm
      description: Stops a swarm and terminates all agents.
      operationId: stopSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm stopped
        '404':
          description: Swarm not found

  /api/v1/swarms/{id}/pause:
    post:
      tags:
        - Swarms
      summary: Pause swarm
      description: Pauses all agents in the swarm.
      operationId: pauseSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm paused
        '404':
          description: Swarm not found

  /api/v1/swarms/{id}/resume:
    post:
      tags:
        - Swarms
      summary: Resume swarm
      description: Resumes all agents in the swarm.
      operationId: resumeSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm resumed
        '404':
          description: Swarm not found

  /api/v1/swarms/{id}/scale:
    post:
      tags:
        - Swarms
      summary: Scale swarm
      description: Scales the number of agents in the swarm.
      operationId: scaleSwarm
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - targetSize
              properties:
                targetSize:
                  type: integer
                  minimum: 1
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm scaling initiated
        '400':
          description: Invalid target size

  /api/v1/swarms/{id}/events:
    get:
      tags:
        - Swarms
      summary: Get swarm events
      description: Retrieves events for a specific swarm.
      operationId: getSwarmEvents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Swarm events
        '404':
          description: Swarm not found

  /api/v1/swarms/{id}/branches:
    get:
      tags:
        - Swarms
      summary: List branches
      description: Lists all branches in the swarm session tree.
      operationId: listBranches
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of branches

    post:
      tags:
        - Swarms
      summary: Create branch
      description: Creates a new branch in the session tree.
      operationId: createBranch
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
      security:
        - ApiKeyAuth: []
      responses:
        '201':
          description: Branch created
        '400':
          description: Validation error

  /api/v1/swarms/{id}/switch-branch:
    post:
      tags:
        - Swarms
      summary: Switch branch
      description: Switches to a different branch in the session tree.
      operationId: switchBranch
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - branchName
              properties:
                branchName:
                  type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Branch switched
        '400':
          description: Invalid branch name

  /api/v1/tasks:
    get:
      tags:
        - Tasks
      summary: List all tasks
      description: Retrieves a paginated list of all tasks.
      operationId: listTasks
      parameters:
        - name: status
          in: query
          schema:
            type: string
          description: Filter tasks by status
        - name: assigneeId
          in: query
          schema:
            type: string
          description: Filter by assignee agent ID
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of tasks

    post:
      tags:
        - Tasks
      summary: Create a new task
      description: Creates a new task.
      operationId: createTask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                description:
                  type: string
                priority:
                  type: string
                  enum: [low, medium, high, critical]
                  default: medium
      security:
        - ApiKeyAuth: []
      responses:
        '201':
          description: Task created

  /api/v1/tasks/{id}:
    get:
      tags:
        - Tasks
      summary: Get task details
      operationId: getTask
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Task details
        '404':
          description: Task not found

    put:
      tags:
        - Tasks
      summary: Update task
      operationId: updateTask
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Task updated
        '404':
          description: Task not found

    delete:
      tags:
        - Tasks
      summary: Delete task
      operationId: deleteTask
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - ApiKeyAuth: []
      responses:
        '204':
          description: Task deleted
        '404':
          description: Task not found

  /api/v1/tasks/{id}/assign:
    post:
      tags:
        - Tasks
      summary: Assign task
      description: Assigns a task to an agent.
      operationId: assignTask
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
              properties:
                agentId:
                  type: string
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Task assigned
        '404':
          description: Task not found

  /api/v1/bus/publish:
    post:
      tags:
        - Bus
      summary: Publish event
      description: Publishes an event to the event bus.
      operationId: publishEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
              properties:
                type:
                  type: string
                  description: Event type
                payload:
                  type: object
                  description: Event payload
                source:
                  type: string
                  description: Event source
                target:
                  type: string
                  description: Target identifier
      responses:
        '201':
          description: Event published
        '400':
          description: Validation error

  /api/v1/bus/subscribe:
    get:
      tags:
        - Bus
      summary: Subscribe to events
      description: Subscribes to events via Server-Sent Events (SSE).
      operationId: subscribeEvents
      parameters:
        - name: type
          in: query
          schema:
            type: string
          description: Filter by event type
        - name: target
          in: query
          schema:
            type: string
          description: Filter by target
      responses:
        '200':
          description: SSE stream of events

  /api/v1/bus/events:
    get:
      tags:
        - Bus
      summary: Get recent events
      description: Retrieves recent events from the event bus.
      operationId: getEvents
      parameters:
        - name: type
          in: query
          schema:
            type: string
          description: Filter by event type
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: List of events

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    Agent:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
        status:
          type: string
        lifecycleState:
          type: string
        model:
          type: string
        task:
          type: string
        spawnedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        runtime:
          type: integer
        swarmId:
          type: string
        parentId:
          type: string
        childIds:
          type: array
          items:
            type: string
        retryCount:
          type: integer
        maxRetries:
          type: integer
        budgetLimit:
          type: number
        metadata:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        meta:
          type: object
          properties:
            timestamp:
              type: string
            requestId:
              type: string
