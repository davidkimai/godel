spec:
  id: SPEC-ORCH-001
  name: Orchestrator V4 System
  version: 4.0.0
  status: active

description: |
  Central orchestration system for Dash v2.0 autonomous operations.
  Manages swarm spawning, task prioritization, and integrates with
  self-healing and context optimization systems for continuous
  autonomous operation.

requirements:
  - id: REQ-001
    description: Spawn swarms based on task priority
    priority: P0
    test: orchestrator-v3.js spawns correct swarm type

  - id: REQ-002
    description: Maintain minimum 3 swarms at all times
    priority: P0
    test: swarm count never drops below 3

  - id: REQ-003
    description: Prioritize critical tasks (build broken > coverage < 10%)
    priority: P0
    test: Critical tasks spawn within 1 minute

  - id: REQ-004
    description: Support Kimi K2P5 model for swarm execution
    priority: P0
    test: kimi-coding/k2p5 used for spawning

  - id: REQ-005
    description: Integrate with Build Monitor (30-sec checks)
    priority: P1
    test: Build failures trigger immediate swarm

  - id: REQ-006
    description: Generate 30-min progress reports
    priority: P1
    test: PROGRESS_REPORT cron generates reports

  - id: REQ-007
    description: Log all orchestration events
    priority: P2
    test: Events logged to .dash/orchestrator.log

implementation:
  files:
    - scripts/orchestrator-v3.js
    - scripts/health-check.js
    - scripts/start-autonomous.sh
    - src/core/autonomous-state.ts

prompt_template: |
  You are building Orchestrator V4 for Dash v2.0.

  This system is the central controller for autonomous operations:
  1. Spawns swarms based on task priority
  2. Maintains minimum 3 swarms
  3. Integrates with build monitor and watchdog
  4. Uses Kimi K2P5 for swarm execution
  5. Generates progress reports

  Requirements (P0 = critical):
  - [P0] Spawn swarms by task priority
  - [P0] Never drop below 3 swarms
  - [P0] Critical tasks spawn within 1 minute
  - [P0] Use kimi-coding/k2p5 model
  - [P1] Integrate with Build Monitor (30-sec)
  - [P1] Generate 30-min progress reports
  - [P2] Log all orchestration events

  Current Implementation:
  - scripts/orchestrator-v3.js: main orchestrator
  - scripts/health-check.js: system health
  - scripts/start-autonomous.sh: startup script
  - src/core/autonomous-state.ts: state management

  Cron Jobs Managed:
  - DASH_BUILD_MONITOR: Every 30 sec
  - DASH_ORCHESTRATOR_V4: Every 1 min
  - DASH_SWARM_WATCHDOG: Every 2 min
  - DASH_PROGRESS_REPORT: Every 30 min
  - CONTEXT_SUMMARIZATION: Every 30 min

  Tasks:
  1. Verify orchestrator-v3.js functional
  2. Test swarm spawning with kimi-coding/k2p5
  3. Verify minimum 3 swarms maintained
  4. Test critical task prioritization
  5. Verify cron integrations
  6. Test progress report generation
  7. Verify event logging

  Success Criteria:
  - [ ] Swarms spawn correctly
  - [ ] 3+ swarms always running
  - [ ] Critical tasks <1 min response
  - [ ] Kimi K2P5 model used
  - [ ] Cron jobs firing on schedule
  - [ ] Progress reports generated
  - [ ] Events logged

validation:
  command: npm run build && node scripts/orchestrator-v3.js --status
  coverage_threshold: 90

metadata:
  created: 2026-02-02
  author: SDD System
  tags: [orchestrator, swarm, critical]
  related:
    - ORCHESTRATION_IDEAL.md
    - IMPLEMENTATION_COMPARISON.md
