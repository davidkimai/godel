spec:
  id: SPEC-CRON-001
  name: Dash Cron Jobs System
  version: 1.0.0
  status: active

description: |
  Comprehensive cron job system for Dash v2.0 autonomous operations.
  Manages build monitoring, swarm orchestration, watchdog, progress reporting,
  and context summarization with spec-driven validation.

requirements:
  - id: REQ-001
    description: Build Monitor runs every 30 seconds
    priority: P0
    test: crontab -l | grep "DASH_BUILD_MONITOR" | grep "30s\|every 30"

  - id: REQ-002
    description: Orchestrator V4 runs every 1 minute
    priority: P0
    test: crontab -l | grep "DASH_ORCHESTRATOR_V4" | grep "1 min\|every 1"

  - id: REQ-003
    description: Swarm Watchdog runs every 2 minutes
    priority: P0
    test: crontab -l | grep "DASH_SWARM_WATCHDOG" | grep "2 min\|every 2"

  - id: REQ-004
    description: Progress Report runs every 30 minutes
    priority: P1
    test: crontab -l | grep "DASH_PROGRESS_REPORT" | grep "30 min\|every 30"

  - id: REQ-005
    description: Context Summarization runs every 30 minutes
    priority: P1
    test: crontab -l | grep "CONTEXT_SUMMARIZATION" | grep "30 min\|every 30"

  - id: REQ-006
    description: All cron jobs fire on schedule
    priority: P0
    test: grep "DASH_BUILD_MONITOR\|DASH_ORCHESTRATOR_V4\|DASH_SWARM_WATCHDOG\|DASH_PROGRESS_REPORT\|CONTEXT_SUMMARIZATION" /var/log/system.log | wc -l | test "> 100"

  - id: REQ-007
    description: Failed cron jobs trigger self-healing
    priority: P1
    test: grep "cron.*failed\|cron.*error" /var/log/system.log | self-healing-triggered

  - id: REQ-008
    description: Cron health logged to .dash/cron-health.json
    priority: P2
    test: cat .dash/cron-health.json | jq '.lastCheck' | test "not null"

implementation:
  files:
    - scripts/health-check.js
    - scripts/start-autonomous.sh
    - src/core/autonomous-state.ts
    - .dash/cron-health.json

prompt_template: |
  You are implementing the Dash Cron Jobs System for Dash v2.0.

  The cron system manages 5 critical jobs:
  1. DASH_BUILD_MONITOR (every 30s) - Checks build status, detects failures
  2. DASH_ORCHESTRATOR_V4 (every 1min) - Spawns/manages swarms
  3. DASH_SWARM_WATCHDOG (every 2min) - Ensures 3+ swarms active
  4. DASH_PROGRESS_REPORT (every 30min) - Generates progress reports
  5. CONTEXT_SUMMARIZATION (every 30min) - Context compression

  Requirements:
  - All jobs must reference this spec
  - Jobs must log health to .dash/cron-health.json
  - Failed jobs trigger self-healing
  - All jobs fire on schedule

  Implementation Guidelines:
  - Use OpenClaw gateway for scheduling
  - Log each job execution with timestamp
  - Track job success/failure rates
  - Auto-restart failed jobs

  Success Criteria:
  - [ ] All 5 cron jobs configured
  - [ ] Jobs fire on schedule (verified in logs)
  - [ ] Health logged to .dash/cron-health.json
  - [ ] Failed jobs trigger self-healing

validation:
  command: crontab -l && node scripts/health-check.js --cron
  coverage_threshold: 90

metadata:
  created: 2026-02-02
  author: Overnight Executive
  tags: [cron, scheduling, autonomous, critical]
  related:
    - specs/active/swarm-self-healing-v2.yaml
    - specs/active/self-healing.yaml
    - scripts/health-check.js
