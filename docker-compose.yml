version: '3.8'

services:
  dash:
    image: dash:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: dash-dev
    restart: unless-stopped
    ports:
      - "7373:7373"
    environment:
      - NODE_ENV=development
      - PORT=7373
      - DASH_API_KEY=dash-api-key
      - DATABASE_PATH=/data/dash.db
      - LOG_LEVEL=debug
    volumes:
      - ./dash.db:/data/dash.db
      - ./logs:/app/logs
    depends_on:
      - redis
    networks:
      - dash-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7373/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  redis:
    image: redis:7-alpine
    container_name: dash-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    networks:
      - dash-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Optional: Admin UI
  admin-ui:
    image: dash-admin:latest
    container_name: dash-admin
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - DASH_API_URL=http://dash:7373
      - DASH_API_KEY=dash-api-key
    depends_on:
      - dash
    networks:
      - dash-network
    profiles:
      - ui

volumes:
  redis-data:
    driver: local

networks:
  dash-network:
    driver: bridge

# Development shortcuts
# Start: docker-compose up -d
# Stop: docker-compose down
# View logs: docker-compose logs -f dash
# Restart: docker-compose restart dash
# Scale: docker-compose up -d --scale dash=3
